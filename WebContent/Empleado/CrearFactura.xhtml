<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js" type="javascript"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" type="javascript"></script>
	<h:head>
	    <title> Factura</title>
	    <style type="text/css">
				
				* {
					margin:0px;
					padding:0px;
				}
				
				#header {
					margin:auto;
					width:500px;
					font-family:Arial, Helvetica, sans-serif;
				}
				
				ul, ol {
					list-style:none;
				}
				
				.nav > li {
					float:left;
				}
				
				.nav li a {
					background-color:#000;
					color:#fff;
					text-decoration:none;
					padding:10px 12px;
					display:block;
				}
				
				.nav li a:hover {
					background-color:#434343;
				}
				
				.nav li ul {
					display:none;
					position:absolute;
					min-width:140px;
				}
				
				.nav li:hover > ul {
					display:block;
				}
				
				.nav li ul li {
					position:relative;
				}
				
				.nav li ul li ul {
					right:-140px;
					top:0px;
				}
				
				boton {
				  border-radius: 5px;
				  background: black;
				}
				
				.tabla {
					border-collapse: collapse;
				}
				
				.cabeceraTabla {
					text-align: center;
					background: none repeat scroll 0 0 #E5E5E5;
					border-bottom: 1px solid #BBBBBB;
					padding: 8px;
				}
				
				.filaPar {
					text-align: center;
					background: none repeat scroll 0 0 #FFFFFFF;
					border-top: 1px solid #BBBBBB;
				}
				
				.filaImpar {
					text-align: center;
					background: none repeat scroll 0 0 #F9F9F9;
					border-top: 1px solid #BBBBBB;
				}
				
				#contenedorProductos{
					clear: both;
				    float: left;
				    width: 46%;
				    height: auto;
				    margin-left: 5%;
				    margin-top: 2%;
				}
				
				#buscarProdFac{
					clear: both;
				    float: left;
				    margin-left: 5%;
				    margin-top: 1%;
				}
				
				
				#contenedorFactura{
					float: left;
					width: 40%;
				    height: auto;
					margin-left: 3%;
				}
						
			</style>
	</h:head>
	<nav>
	    <h:form id="formGestionClientes">
	    	<ul class="nav">
				<li><a>Gestionar Facturas</a>
					<ul>
						<li><h:commandLink value="Crear Factura" action="#{navigator.reglaRedir('CreacionFactura')}" /></li>
						<li><h:commandLink value="Listar Facturas" action="#{navigator.reglaRedir('listarFactura')}" /></li>
					</ul>
				</li>
				<li><a>Gestionar Clientes</a>
					<ul>
						<li><h:commandLink value="Crear Cliente" action="#{navigator.reglaRedir('crearCliente')}" /></li>
						<li><h:commandLink value="Listar Clientes"  action="#{navigator.reglaRedir('listarClientes')}" /></li>
					</ul>
				</li>
				<li><a href="">Cerrar Sesion</a></li>
			</ul>
	    </h:form>
	</nav>
	<h:body>
		<h:form id="fa1">
			<div id="buscarProdFac">
				<h3>Buscar por nombre</h3>
				<p:inputText id="nombreBuscar" value="#{productoBean.nombreBusq}" type="text"></p:inputText>
				<p:commandButton value="Buscar" action="#{productoBean.buscarPorNombre}" update="fa1">
				</p:commandButton>
			</div>
		    <div id="contenedorProductos">
		    	<p:dataTable id="tablaProd" value="#{productoBean.pedidos}" var="ped"
					 headerClass="cabeceraTabla" rowClasses="filaPar,filaImpar">
					<p:column headerText="Id">
	                	<h:outputText value="#{ped.producto.id}"/>
	                </p:column>
	            	<p:column headerText="Nombre">
	                	<h:outputText value="#{ped.producto.nombre}"/>
	                </p:column>
	                <p:column headerText="Stock">
		                <h:outputText value="#{ped.producto.stock}"/>
	            	</p:column>
	                <p:column headerText="Bodega">
	                	<h:outputText value="#{ped.producto.bodegas.get(0).nombre}" />
	                </p:column>
		    		<p:column headerText="Cantidad a Pedir">
		                <p:inputText id="cantidad" name="header" value="#{ped.cantidad}" type="text"></p:inputText>
	            	</p:column> 
	            	<p:column headerText="">
	            		<p:commandButton value="Agregar" actionListener="#{facturaDetalleBean.addDetallesFac(ped)}" update="fa1 fa3">
	            		</p:commandButton>
	            	</p:column>
		    	</p:dataTable>
		    </div>   
		  </h:form>  
		  <div id="contenedorFactura">
		  <h:form id="fa2"> 
				<h3>Buscar Cliente</h3>
				<p></p>
				<h:inputText id="cedulaBuscar" value="#{personaBean.cedula}" type="text"></h:inputText>
				<h:commandButton value="buscarPersona" action="#{personaBean.buscarPersonaCedula}">
					<f:ajax execute="cedulaBuscar" render="salidaNombre salidaApellido salidaCedula salidaTelefono salidaDireccion" />
				</h:commandButton>
				<p></p>
				<h:outputLabel for="salidaNombre" value="Nombre:" ></h:outputLabel>
				<h:inputText id="salidaNombre" value="#{personaBean.nombre}"></h:inputText>
		        <h:outputLabel for="salidaApellido" value="Apellido:"></h:outputLabel>
		        <h:inputText id="salidaApellido" value="#{personaBean.apellido}"></h:inputText>
		        <p></p>
		        <h:outputLabel for="salidaTelefono" value="Telefono:" ></h:outputLabel>
		        <h:inputText id="salidaTelefono" value="#{personaBean.telefono}"></h:inputText>
		        <h:outputLabel for="salidaDireccion" value="Direccion:" ></h:outputLabel>
		        <h:inputText id="salidaDireccion" value="#{personaBean.direccion}"></h:inputText>
		  </h:form>
		  <h:form id="fa3">    
		        <div id="detalleFactura">
	        		<p:dataTable id="tablaDetalle" value="#{facturaDetalleBean.detallesFac}" var="detalle" styleClass="tabla"
						headerClass="cabeceraTabla" rowClasses="filaPar,filaImpar">
						<p:column>
		                	<f:facet name="header" id="prodId">Producto</f:facet>#{detalle.producto.nombre}
		                </p:column>
		            	<p:column>
		                	<f:facet name="header" id="prodNombre">Precio</f:facet>#{detalle.producto.precio}
		                </p:column>
		                <p:column>
			                <f:facet name="header" id="prodStock">Cantidad</f:facet>#{detalle.cantidad}
		            	</p:column>
		                <p:column>
		                	<f:facet name="header" id="prodBodega">Total</f:facet>#{detalle.total}
		                </p:column>
			    	</p:dataTable>
		        </div>
		        <p>
		        <h:outputLabel for="salidaDireccion" value="Subtotal: #{facturaDetalleBean.subtotal}" ></h:outputLabel>
		        </p>
		        <p>
		        <h:outputLabel for="salidaDireccion" value="IVA: #{facturaDetalleBean.iva}" ></h:outputLabel>
		        </p>
		        <h:outputLabel for="salidaDireccion" value="Total: #{facturaDetalleBean.totalFinal}" ></h:outputLabel>
		         <p></p>
		        <p:commandButton value="Realizar Factura" action="#{facturaDetalleBean.guardarFactura()}" update="fa1 fa2 fa3">
				</p:commandButton>
		</h:form>
		</div>
	</h:body>
</html>
